#include colors.yml
#include read-write.yml
#include on-off.yml
#include tweak-control.yml

_MotorLine: !Template:MotorLine
    - !Defaults
        height: 30
        
        spacing: 0
        
        read-first: True
        read-only: False
        
        link-screen: "motor1x1"
        link-macros: "P={motor-pv},M1="
        
        enable-pv: "{motor-pv}.CNEN"
        enable-width: 20
        enable-height: 20
        enable-element:
            - !Calc
                A:    "{motor-pv}.MSTA"
                calc: "(A&2048)==2048"
                pv:   "{motor-pv}TorqueDisplay"
                
            - !Group
                visibility: "{motor-pv}TorqueDisplay"
                margins: 0x0x8x0
                children: [ !Embed:enable-default ]
        
        desc-pv: "{motor-pv}.DESC"
        desc-width: 200
        desc-background: *white
        desc-foreground: *header_blue
        desc-element:
            - !Group
                geometry: "{desc-width}x{desc-height}"
                background: "{desc-background}"
                margins: 4x6x4x6
                children:
                    - !AStretch:TextMonitor
                        foreground: "{desc-foreground}"
                        pv: "{motor-pv}.DESC"
                        
                    - !AStretch:RelatedDisplay
                        background: *transparent
                        links:
                            - { label: "motor", file: "{link-screen}", macros: "{link-macros}" }
        
        read-pv: "{motor-pv}.RBV"
        read-width: 120
        read-foreground: *header_blue
        read-alignment: CenterLeft
        read-element:
            - !Group
                geometry: "{read-width}x{read-height}"
                children:
                    - !AStretch:Group
                        border-width: 2
                        border-color: *black
                        visibility: "{motor-pv}.SET"
                        children:
                            - !AStretch:Group
                                border-width: 2
                                border-color: *alarm_yellow
                                visibility: "{motor-pv}.SET"
                                
                    - !AStretch:Group
                        margins: "8x4x8x4"
                        children:
                            - !AStretch:TextMonitor
                                foreground: "{read-foreground}"
                                pv: "{read-pv}"
                            
                    - !VStretch:Rectangle
                        geometry: "8x0"
                        visibility: "{motor-pv}.LLS"
                        border-color: *transparent
                        background: *alarm_red
                                
                    - !HAnchor:VStretch:Rectangle
                        geometry: "8x0"
                        visibility: "{motor-pv}.HLS"
                        border-color: *transparent
                        background: *alarm_red
        
        
        entry-pv: "{motor-pv}.VAL"
        entry-width: 100
        entry-element:
            - !Group
                geometry: "{entry-width}x{entry-height}"
                children:
                    - !AStretch:Rectangle
                        border-color: *transparent
                        background: *alarm_green
                        visibility: !Not "{motor-pv}.DMOV"
                        
                    - !AStretch:Rectangle
                        border-color: *transparent
                        background: *alarm_yellow
                        visibility: "{motor-pv}.LVIO"
                        
                    - !AStretch:Group
                        margins: 4x4x4x4
                        children:
                            - !AStretch:TextEntry
                                background: "{entry-background}"
                                pv: "{entry-pv}"
        
        
        tweak-val-pv: "{motor-pv}.TWV"
        tweak-pos-pv: "{motor-pv}.TWF"
        tweak-neg-pv: "{motor-pv}.TWR"
        tweak-width: 60
        tweak-height: 22
        tweak-element:
            - !Group
                margins: 5x4x0x4
                children:
                    - !Embed:tweak-default

    - !Apply:PVReadWrite
        
